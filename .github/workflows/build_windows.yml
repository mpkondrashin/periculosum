on: [push]
jobs:
  Build-Windows-Release:
    runs-on: windows-latest
    strategy:
      matrix:
         include:
           - platform: 'x86_64'
             packages: >-
              base
              make
              autoreconf
              libtool
              autoconf
              automake
              gcc-g++
              zip
      fail-fast: false
    steps:
      - name: Config Git
      - run: git config --global core.autocrlf input
      - name: Check out repository code
      - uses: actions/checkout@v3
      - name: Install Cygwin
      - uses: cygwin/cygwin-install-action@master
        with:
          platform: ${{ matrix.platform }}
          packages: ${{ matrix.packages }}
      - name: Build
        run: bash -c make; ls -l
      - name: Test Periculosum
        run: make test
      - name: Setup Go
        uses: actions/setup-go@v2
      - name: Check Go version
        run: go version
      - name: Test Checker
        run: cd goperic; go test -v
      - name: Pack release
        run: base release_windows.sh
      - name: Release for Windows
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: release_windows64.zip